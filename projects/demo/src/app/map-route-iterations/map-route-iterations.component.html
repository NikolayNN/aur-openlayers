<section class="map-container">
  <header class="map-header">
    <h2>Маршрут с изменением порядка</h2>
    <p>
      Точки соединены линией, индекс отображается прямо в круге.
      Наведение раскрывает детали, выбор точки позволяет изменить имя и порядок в списке.
    </p>
  </header>

  <div class="map-layout">
    <aside class="map-panel">
      <div class="map-panel__block">
        <div class="map-panel__header">
          <h3>Выбранная точка</h3>
          <span class="map-panel__badge" [class.is-active]="isDragging">
            {{ isDragging ? 'перемещение…' : 'ожидание' }}
          </span>
        </div>
        <ng-container *ngIf="selectedPoint; else emptySelection">
          <label class="map-panel__label" for="point-name">Название</label>
          <input
            id="point-name"
            class="map-panel__input"
            type="text"
            [(ngModel)]="selectedPointName"
            (ngModelChange)="onSelectedPointNameChange($event)"
          />
          <dl class="map-panel__list">
            <div>
              <dt>Индекс</dt>
              <dd>{{ selectedPoint.orderIndex }}</dd>
            </div>
            <div>
              <dt>Lat</dt>
              <dd>{{ selectedPoint.lat | number : '1.4-4' }}</dd>
            </div>
            <div>
              <dt>Lng</dt>
              <dd>{{ selectedPoint.lng | number : '1.4-4' }}</dd>
            </div>
          </dl>
        </ng-container>
        <ng-template #emptySelection>
          <p class="map-panel__empty">Выберите точку на карте, чтобы редактировать имя.</p>
        </ng-template>
      </div>

      <div class="map-panel__block">
        <h3>Порядок точек</h3>
        <p class="map-panel__hint">Используйте стрелки, чтобы менять последовательность маршрута.</p>
        <ul class="order-list">
          <li *ngFor="let point of orderedPoints; let i = index"
              class="order-list__item"
              (click)="selectPoint(point)"
              [class.is-selected]="point.id === selectedPoint?.id"
          >
            <span class="order-list__index">{{ point.orderIndex }}</span>
            <span class="order-list__name">{{ point.name }}</span>
            <div class="order-list__actions">
              <button type="button" (click)="movePointUp(i)" aria-label="Move up">↑</button>
              <button type="button" (click)="movePointDown(i)" aria-label="Move down">↓</button>
            </div>
          </li>
        </ul>
      </div>
    </aside>

    <div class="map-wrapper">
      <mff-map-host
        #mapHost
        class="map-canvas"
        [config]="mapConfig"
        (ready)="onReady($event)"
      ></mff-map-host>
      <div #popupHost class="map-popup-host"></div>
    </div>
  </div>
</section>
